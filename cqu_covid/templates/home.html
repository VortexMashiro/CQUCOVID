
  {% extends "layout/fullscreen_layout.html" %}
  {% block content %}
  <style>
        .content {
  display: flex;
  flex: 1;
  width: 100%;
  position: relative;
  overflow: hidden;
  padding-top: 0px; /* redefined in sp.css */
  height: 100vh !important;
  
}
.selected {
  background: linear-gradient(98.7deg, rgba(255, 255, 255, 0.3) 0%, rgba(235, 235, 235, 0.3) 100%), radial-gradient(50% 351.19% at 50% 50%, rgba(0, 128, 157, 0.016) 0%, rgba(0, 128, 157, 0.02) 100%), #FFFFFF !important;
  box-shadow: 0px 3px 5px rgba(0, 0, 0, 0.1) !important;
  border: 1px solid #00809D !important;
}
.area:hover {
  background: linear-gradient(98.7deg, rgba(255, 255, 255, 0.3) 0%, rgba(235, 235, 235, 0.3) 100%), radial-gradient(50% 351.19% at 50% 50%, rgba(0, 128, 157, 0.016) 0%, rgba(0, 128, 157, 0.02) 100%), #FFFFFF;
  box-shadow: 0px 3px 5px rgba(0, 0, 0, 0.1);
  border: 1px solid #00809D;
}
.news_item:hover{
  text-decoration: underline
}
.news_item{
  border-bottom: solid;
}
      </style>
  <div class="header">
    <a href="" target="_self" class="covidHeader">
      <h1 class="pageName">COVID-19</h1>
    </a>
    <div class="spacer"></div>
    <div class="headerButtons"></div>
  </div> <!-- header -->

<div class="content">
  <div class="countryPanel">
      <div class="country tab" role="Region" aria-label="国家/地区列表">
          <div class="timelinePillWrapper">
              <div class="timelinePill" onclick="naviToTimeline()">COVID-19 时间线 ❯</div>
          </div>
          <div class="infoTile" style="width: 272px;">
              <div class="infoTileHeader">
                  <div>
                      <h2 class="title" title="累计确诊">累计确诊</h2>
                      <div class="lastUpdate"> 数据更新于：{{data_date}} </div>
                  </div>
                  <div class="infoTileIconCon">
                      <div class="infoTitleInfo" title="数据信息" tabindex="0"><svg width="16" height="16" viewBox="0 0 16 16"
                              fill="none" role="img" aria-label="数据信息">
                              <title>数据信息</title>
                              <path
                                  d="M8 1C6.61553 1 5.26215 1.41054 4.11101 2.17971C2.95987 2.94888 2.06266 4.04213 1.53285 5.32122C1.00303 6.6003 0.86441 8.00776 1.13451 9.36563C1.4046 10.7235 2.07129 11.9708 3.05026 12.9497C4.02922 13.9287 5.2765 14.5954 6.63437 14.8655C7.99224 15.1356 9.3997 14.997 10.6788 14.4672C11.9579 13.9373 13.0511 13.0401 13.8203 11.889C14.5895 10.7378 15 9.38447 15 8C15 6.14348 14.2625 4.36301 12.9497 3.05025C11.637 1.7375 9.85652 1 8 1ZM9 9.5V11C9 11.2652 8.89464 11.5196 8.70711 11.7071C8.51957 11.8946 8.26522 12 8 12C7.73479 12 7.48043 11.8946 7.2929 11.7071C7.10536 11.5196 7 11.2652 7 11V8C7 7.73478 7.10536 7.48043 7.2929 7.29289C7.48043 7.10536 7.73479 7 8 7C8.26522 7 8.51957 7.10536 8.70711 7.29289C8.89464 7.48043 9 7.73478 9 8V9.5ZM8.707 5.707C8.54338 5.87057 8.32811 5.97235 8.09786 5.99499C7.86761 6.01763 7.63664 5.95973 7.44429 5.83116C7.25195 5.70259 7.11013 5.51131 7.04301 5.2899C6.97589 5.0685 6.98762 4.83066 7.07619 4.61693C7.16477 4.4032 7.32471 4.2268 7.52877 4.11777C7.73283 4.00875 7.96838 3.97386 8.19529 4.01904C8.42219 4.06422 8.62641 4.18668 8.77314 4.36555C8.91988 4.54442 9.00005 4.76864 9 5C8.99994 5.26519 8.89455 5.51951 8.707 5.707Z"
                                  fill="#767676"></path>
                          </svg></div>
                  </div>
              </div>
              <!-- global_status here. -->
              <div class="infoTileConfirmed">
                  <div class="confirmed">{{global_status.total}}</div>
                  <div class="deltaConfirmed" title="new cases over the last 24 hours">+{{global_status.total_today}}</div>
              </div>
              <div class="infoTileData">
                  <h2 class="legend">
                      <div class="color" style="background: rgb(244, 195, 99);"></div>
                      <div class="description">现有确诊</div>
                      <div class="total">
                        <div class="">{{global_status.confirm_total}}</div>
                        <div class="delta" title="new cases over the last 24 hours">+{{global_status.confirm_today}}</div>
                      </div>
                      
                  </h2>
                  <h2 class="legend">
                      <div class="color" style="background: rgb(96, 187, 105);"></div>
                      <div class="description">累计治愈</div>
                      <div class="total">
                          <div class="">{{global_status.recover_total}}</div>
                          <div class="delta" title="new cases over the last 24 hours">+{{global_status.recover_today}}</div>
                      </div>
                  </h2>
                  <h2 class="legend">
                      <div class="color" style="background: rgb(118, 118, 118);"></div>
                      <div class="description">累计死亡</div>
                      <div class="total">
                          <div class="">{{global_status.death_total}}</div>
                          <div class="delta" title="new cases over the last 24 hours">+{{global_status.death_today}}</div>
                      </div>
                  </h2>
              </div>
          </div>
          <div class="combinedArea">
              <div class="areas deep">
                {% for element in countrylist %}
                <div class="areaDiv">
                    <div class="area">
                        <div class="areaName" onclick="getBar(this)"  id="{{element.name}}">{{element.name}}</div>
                        <div class="areaTotal">
                            <div class="secondaryInfo">{{element.number}}</div>
                        </div>
                        
                    </div>
                </div>
                {% endfor %}
              </div>
          </div>
          
      </div>
  </div>  <!-- countryPanel -->

  <div class="verticalWrapper">
    <div class="verticalHeader">
      <div class="locationWrapper"><h2 class="locationTitle">全球</h2></div>
      <div
        class="verticalOptions"
        style="grid-template-columns: repeat(3, min-content);"
      >
        <div class="verticalOption selected" tabindex="0">概况</div>
        <div class="verticalOption" tabindex="0">资讯和视频</div>
        <div class="verticalOption" tabindex="0">图表</div>
        <div
          class="verticalIndicator"
          style="transform: translateX(0px) scaleX(1);"
        ></div>
      </div>
    </div>    <!-- verticalHeader -->
    <div class="verticalContent">
      <div class="overview">
        <div class="overviewContent">
          <!-- <h3 class="pageName">详情</h3> -->
          <div class="segmentPanel">
            <div id="bar" style="height:40vh"></div> 
            <!-- this is a ajax pyecharts. -->
            <div id="news"  style="height:40vh">
              <h3 class="pageName">相关资讯</h3>
              <div class='container'>
                <!-- news list -->
                <div class="news_item" >
                  <a id="news_url1" href="">
                  <div class='row'>
                    <div class="col-sm">
                      <h5 class="news_content" id='news_title1'>
                        ...China-Africa Summit on Solidarity Against COVID-19
                      </h5>
                      <p class="news_des" id='news_content1'>
                        Xi made the remarks in Beijing when chairing the Extraordinary China-Africa Summit on Solidarity against COVID-19 on June 17.
                      </p>
                    </div>
                  </div>
                  </a>
                </div><!-- news item -->

                <div class="news_item" >
                  <a id="news_url2" href="">
                  <div class='row'>
                    <div class="col-sm">
                      <h5 class="news_content" id='news_title2'>
                        ...China-Africa Summit on Solidarity Against COVID-19
                      </h5>
                      <p class="news_des" id='news_content2'>
                        Xi made the remarks in Beijing when chairing the Extraordinary China-Africa Summit on Solidarity against COVID-19 on June 17.
                      </p>
                    </div>
                  </div>
                  </a>
                </div><!-- news item -->

                <div class="news_item" >
                  <a id="news_url3" href="">
                  <div class='row'>
                    <div class="col-sm">
                      <h5 class="news_content" id='news_title3'>
                        ...China-Africa Summit on Solidarity Against COVID-19
                      </h5>
                      <p class="news_des" id='news_content3'>
                        Xi made the remarks in Beijing when chairing the Extraordinary China-Africa Summit on Solidarity against COVID-19 on June 17.
                      </p>
                    </div>
                  </div>
                  </a>
                </div><!-- news item -->

              </div>
            </div>
          </div>
        </div>
      </div>



      <div class="map" role="main" style="height: 100%; width: 100%; overflow: hidden;">
        <div class="mapContainer allowGL">
            <div class="wrapper-bingmaps" style="height: 100%; position: relative;">
                <div class="PyechartMap" id="globalMap" style="position: absolute; width: 100%; height: 100%; left: 0px; top: 0px;">
                  <!-- {{ myechart|safe }} -->
                </div>
            </div>
        </div>
    </div>    <!-- verticalContent -->

    </div>


  </div>  <!-- verticalWrapper -->
















</div> <!-- content -->
    <script>
        var current_country=$('#Worldwide').parent();
        $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
        var chart = echarts.init(document.getElementById('bar'), 'white', {renderer: 'canvas'});
        var global_map = echarts.init(document.getElementById('globalMap'), {renderer: 'canvas'});
        chart.on('click',function(params){
          console.log('click trigger');
          chart.dispatchAction({
                 type:'showTip',
                 name:params.name
                 //position:['50%', '50%']
                })
          updateGlobalMap(params.name);
          current_country.removeClass('selected');
          current_country=$('#'+params.name).parent();
          current_country.addClass('selected');
          console.log(params.name);
          var data = {
                  data: JSON.stringify({
                    'name': params.name,
                  }),
                }
          $.ajax({
                    type: "GET",
                    url: $SCRIPT_ROOT+"/getConuntryBar",
                    data:data,
                    dataType: 'json',
                    success: function (result) {
                        chart.setOption(result);
                    }
                });
        })
        //this will be called when clicking a country in countrylist
        function getBar(event){
          getNews(event.id);
          // chart.dispatchAction({
          //         type: 'hideTip'
          //       })
          chart.dispatchAction({
                 type:'showTip',
                 name:event.id
                 //position:['50%', '50%']
                })
          updateGlobalMap(event.id);
          current_country.removeClass('selected');
          current_country=$('#'+event.id).parent();
          current_country.addClass('selected');
          console.log(event.id);
          var data = {
                  data: JSON.stringify({
                    'name': event.id,
                  }),
                }
          $.ajax({
                    type: "GET",
                    url: $SCRIPT_ROOT+"/getConuntryBar",
                    data:data,
                    dataType: 'json',
                    success: function (result) {
                        chart.setOption(result);
                    }
                });
        }
        function echartConfig(result){
          eval('result.tooltip.formatter='+result.tooltip.formatter);
          result.visualMap.bottom='5%';
          result.visualMap.right='5%';
          result.tooltip.position='top';
          //var comfirmed = new Array();
          for (i=0;i<result.series[0].data.length;i++){
            result.series[0].data[i].value.push(result.series[0].data[i].value[2][0]);
          }
        }
        //this will call getBar() with the data 'Worldwide'
        function initBar(){
          current_country.addClass('selected');
          var data = {
                  data: JSON.stringify({
                    'name': 'Worldwide',
                  }),
                }
          $.ajax({
                    type: "GET",
                    url: $SCRIPT_ROOT+"/getConuntryBar",
                    data:data,
                    dataType: 'json',
                    success: function (result) {

                        chart.setOption(result);
                    }
                });
        }
        function naviToTimeline(){
          window.location.replace('/covid?data={{messager_data}}');
        }

        function initGlobalMap(){
          var data = {
                  data: JSON.stringify({
                    'name': 'Worldwide',
                  }),
                }
          $.ajax({
                    type: "GET",
                    url: $SCRIPT_ROOT+"/getGlobalMap",
                    data:data,
                    dataType: 'json',
                    success: function (result) {
                      echartConfig(result);
                      global_map.setOption(result);
                      console.log('Global Map init Successfully');
                      console.log(result);
                    }
                });
        }

        function updateGlobalMap(country_name){
          var data = {
                  data: JSON.stringify({
                    'name': country_name,
                  }),
                }
          $.ajax({
                    type: "GET",
                    url: $SCRIPT_ROOT+"/getGlobalMap",
                    data:data,
                    dataType: 'json',
                    success: function (result) {
                      echartConfig(result);
                      global_map.setOption(result);
                      console.log('Global Map Update Successfully');
                      console.log(result);
                    }
                });
        }

        function getNews(country_name){
          var data = {
                  data: JSON.stringify({
                    'name': country_name,
                  }),
                }
          $.ajax({
                    type: "GET",
                    url: $SCRIPT_ROOT+"/getNews",
                    data:data,
                    dataType: 'json',
                    success: function (result) {
                      console.log('News Update Successfully');
                      $('#news_title1').html(result.news[0].title);
                      $('#news_title2').html(result.news[1].title);
                      $('#news_title3').html(result.news[2].title);
                      $('#news_content1').html(result.news[0].content);
                      $('#news_content2').html(result.news[1].content);
                      $('#news_content3').html(result.news[2].content);
                      $("#news_url1").attr("href",result.news[0].url);
                      $("#news_url2").attr("href",result.news[1].url);
                      $("#news_url3").attr("href",result.news[2].url);
                    
                      console.log(result);
                    }
                });
        }
        
        initBar();
        initGlobalMap();
        getNews('Worldwide');
    </script>
<div></div>

  {% endblock %}
